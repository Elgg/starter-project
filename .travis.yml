language: php
php:
 - 5.4
 - 5.5
 - 5.6

branches:
  - master

services: 
 - mysql

before_install:
 - "export DISPLAY=:99.0"
 - "sh -e /etc/init.d/xvfb start"
install:
 - "wget http://selenium-release.storage.googleapis.com/2.44/selenium-server-standalone-2.44.0.jar"
 - "java -jar selenium-server-standalone-2.44.0.jar > /dev/null &"
 - sleep 3 # wait for Selenium server to start
 - composer self-update
 - composer install
 - mysql -e 'create database elgg;'
 - echo "USE mysql; UPDATE user SET password=PASSWORD('password') WHERE user='root'; FLUSH PRIVILEGES;" | mysql -u root
 - mkdir "${HOME}/elgg_data/"
 - php -f ./install/cli/travis_installer.php
 - php -S localhost:8888 index.php &
 - sleep 3 # give Web server some time to bind to sockets, etc

script:
 - curl -o - http://localhost:8888/ | grep "<title>Elgg Travis Site</title>"
 - phpunit
